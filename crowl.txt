private void createTableFromCsv(Path csvFilePath, String tableName, Connection connection, char delimiter) {
    try (Reader reader = Files.newBufferedReader(csvFilePath);
         CSVParser csvParser = new CSVParser(reader, CSVFormat.DEFAULT.withDelimiter(delimiter).withFirstRecordAsHeader())) {

        List<String> headers = csvParser.getHeaderNames().stream()
                .flatMap(header -> splitHeader(header.trim()))
                .collect(Collectors.toList());
        headers.add("iteration_id");
        String columns = headers.stream()
                .map(header -> "\"" + header + "\" TEXT")
                .collect(Collectors.joining(", "));

        String createTableSQL = String.format("CREATE TABLE IF NOT EXISTS %s (%s)", tableName, columns);

        // Проверяем, был ли включен автокоммит до этого метода, и отключаем его для транзакции
        boolean initialAutoCommitState = connection.getAutoCommit();
        
        // Синхронизация для предотвращения конкурентного создания
        synchronized (FileImporterService.class) {
            try (Statement statement = connection.createStatement()) {
                connection.setAutoCommit(false);  // Отключаем автокоммит
                statement.execute(createTableSQL); // Создание таблицы
                connection.commit();  // Фиксируем изменения
            } catch (SQLException e) {
                connection.rollback();  // Откат в случае ошибки
                logger.error("Ошибка при создании таблицы {} из файла {}", tableName, csvFilePath.getFileName() + ExceptionFilter.displayError(e));
            } finally {
                // Восстанавливаем исходный режим автокоммита
                connection.setAutoCommit(initialAutoCommitState);
            }
        }
    } catch (IOException | SQLException e) {
        logger.error("Ошибка при чтении csv файла {}", csvFilePath.getFileName() + ExceptionFilter.displayError(e));
    }
}
