Беседа № 129: 
Выбрана Ваша роль: Программист

Понял, в таком случае вам нужно изменить код для создания таблиц с именами файлов и вставки данных в них. Вот пример того, как можно это сделать:

private void importIntoCoreDatabase(Path path, String tableName) {
    try (Connection connection = DriverManager.getConnection(coreDbUrl, coreDbUsername, coreDbPassword);
         Statement statement = connection.createStatement();
         InputStream inputStream = Files.newInputStream(path);
         BufferedReader reader = new BufferedReader(new InputStreamReader(inputStream))) {
        connection.setAutoCommit(false);

        // Создаем таблицу с именем файла
        String createTableSql = "CREATE TABLE core." + tableName + " (data TEXT)";
        statement.executeUpdate(createTableSql);

        // Вставляем данные из файла в таблицу
        String line;
        while ((line = reader.readLine()) != null) {
            String insertSql = "INSERT INTO core." + tableName + " (data) VALUES (?)";
            PreparedStatement preparedStatement = connection.prepareStatement(insertSql);
            preparedStatement.setString(1, line);
            preparedStatement.executeUpdate();
        }

        connection.commit();
        logger.info("Импортирован файл {} в бд Core, создана новая таблица {}", path.getFileName(), tableName);
    } catch (SQLException | IOException e) {
        logger.error("Ошибка импортирования файла {} в бд Core", path.getFileName(), e);
    }
}

private void importIntoOisDatabase(Path path, String tableName) {
    try (Connection connection = DriverManager.getConnection(oisDbUrl, oisDbUsername, oisDbPassword);
         Statement statement = connection.createStatement();
         InputStream inputStream = Files.newInputStream(path);
         BufferedReader reader = new BufferedReader(new InputStreamReader(inputStream))) {
        connection.setAutoCommit(false);

        // Создаем таблицу с именем файла
        String createTableSql = "CREATE TABLE ois." + tableName + " (data TEXT)";
        statement.executeUpdate(createTableSql);

        // Вставляем данные из файла в таблицу
        String line;
        while ((line = reader.readLine()) != null) {
            String insertSql = "INSERT INTO ois." + tableName + " (data) VALUES (?)";
            PreparedStatement preparedStatement = connection.prepareStatement(insertSql);
            preparedStatement.setString(1, line);
            preparedStatement.executeUpdate();
        }

        connection.commit();
        logger.info("Импортирован файл {} в бд OIS, создана новая таблица {}", path.getFileName(), tableName);
    } catch (SQLException | IOException e) {
        logger.error("Ошибка импортирования файла {} в бд OIS ", path.getFileName(), e);
    }
}

Основные изменения:

1. Теперь в начале каждого метода создается новая таблица с именем файла в соответствующей базе данных (Core или OIS).
2. Данные из CSV-файла вставляются в эту таблицу построчно с помощью PreparedStatement.
3. После завершения импорта данных, транзакция коммитится.

Этот код должен работать как требуется - создавать новые таблицы с именами файлов и импортировать данные из CSV-файлов в соответствующие базы данных.

7579 из 16384